<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cache-Git Settings</title>
<link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="css/git-webui.css" />
<STYLE type='text/css'>
.error {
    color: red;
}
</STYLE>
</head>
<body>
<server>
 new $namespace
 set namespace = %request.Data("NSpace",1)
 set $namespace = namespace
 if $Data(%request.Data("gitsettings",1)) {
     kill settings
     for param="gitBinPath","defaultTemp","namespaceTemp","groupByFolder","gitUserName","gitUserEmail" {
         set settings(param) = $Get(%request.Data(param,1))
     } 
     do ##class(SourceControl.Git.Utils).UpdateSettings(.settings)
 }
 set gitBinPath = ##class(SourceControl.Git.Utils).GitBinPath()
 set defaultTemp = ##class(SourceControl.Git.Utils).DefaultTemp()
 set namespaceTemp = ##class(SourceControl.Git.Utils).TempFolder()
 set groupByFolder = ##class(SourceControl.Git.Utils).GroupByFolder()
 set gitUserName = ##class(SourceControl.Git.Utils).GitUserName()
 set gitUserEmail = ##class(SourceControl.Git.Utils).GitUserEmail()
 set:defaultTemp="" defaultTemp =  "c:\temp\"
</server>
<div class = 'container'>
    <div class="col-sm-1"></div>
    <form method='post'>
        <input type="hidden" name="NSpace" value="#(..EscapeHTML(namespace))#" />
        <input type="hidden" name="gitsettings" value="1" />
        <h1>Git Project Settings</h1>
        <h3>Settings for namespace #(..EscapeHTML(namespace))#</h3>

        <div class="form-group row">
            <label for="gitBinPath" class="col-sm-4 col-form-label">Path to git.exe <br> (e.g. C:\Program Files\Git\bin\git.exe)</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="gitBinPath" name="gitBinPath" value='#(..EscapeHTML(gitBinPath))#' placeholder="(e.g. C:\Program Files\Git\bin\git.exe)">
                <csp:if condition='$D(%request.Data("gitsettings",1)) && (##class(SourceControl.Git.Utils).GitBinExists()=0)'>
                    <p class="text-danger">File not found</p>
                </csp:if>
            </div>
        </div>

        <div class="form-group row">
            <label for="defaultTemp" class="col-sm-4 col-form-label">Default path to temp folder <br> (e.g. c:\temp)</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="defaultTemp" name="defaultTemp" value='#(..EscapeHTML(defaultTemp))#'/>
            </div>
        </div>

        <div class="form-group row">
            <label for="namespaceTemp" class="col-sm-4 col-form-label">Temp folder for this namespace<br/>(e.g. c:\someproj\)</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="namespaceTemp" name="namespaceTemp" value='#(..EscapeHTML(namespaceTemp))#'/>
            </div>
        </div>

        <!--
        <div class="form-group row">
            <label for="groupByFolder" class="col-sm-4 col-form-label">Group all items by folders</label>
            <div class="col-sm-8">
                <input type="checkbox" class="form-control" id="groupByFolder" name="groupByFolder" size=40 #($case(groupByFolder,1:"checked",:""))#/>
            </div>
        </div>
        -->

        <h3>Settings for user '#(..EscapeHTML($Username))#'</h3>
        <em>Git settings - if empty, will default to repository/global settings</em>
        <br/><br/><br/>

        <div class="form-group row">
            <label for="gitUserName" class="col-sm-4 col-form-label">Git Committer Name </label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="gitUserName" name="gitUserName" value='#(..EscapeHTML(gitUserName))#'/>
            </div>
        </div>

        <div class="form-group row">
            <label for="gitUserEmail" class="col-sm-4 col-form-label">Git Committer Email </label>
            <div class="col-sm-8">
                <input type="email" class="form-control" id="gitUserEmail" name="gitUserEmail" value='#(..EscapeHTML(gitUserEmail))#'/>
            </div>
        </div>

        <br/><br/>

        <div class="form-group row">
            <div class="col-sm-12 text-center">
                <input type='submit' class="btn-lg btn-primary" value = 'Save'/>
            </div>
        </div>
        
    </form>
    <csp:if condition='$D(%request.Data("gitsettings",1)) && (##class(SourceControl.Git.Utils).NeedSettings() = 0)'>
        <em>Settings saved. Click cross in the upper-right corner to close the settings window.</em>
    </csp:if>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/git-webui.js"></script>
</body>
</html>